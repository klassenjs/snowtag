<!DOCTYPE html>
<html>
<head>
    <title>Map Replay</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <script src="js/heatmap.js"></script>
    <script src="js/heatmap-leaflet.js"></script>
    <script src="js/QuadTree.js"></script>
    <script src="js/addin.js"></script>
</head>
<body>
  <div id="addin-container">

    <div id="addin-map"></div>

    <div id="addin-controls">

      <h3>Snowtagging Heatmap</h3>
      <p class="addin-header-paragraph">
        Visualize snowtagging location history.
      </p>

      <h5>Instructions</h5>
      <p class="addin-header-paragraph">
        Select a vehicle and then select a date range to display where the vehicle has been.
        Areas of the map colored which appear <i>hot</i> indicates that the vehicle has spent time at that location.
      </p>

      <hr />

      <select id="addin-vehicles">
        <option disabled="disabled">Select a vehicle</option>
      </select>

      <h4>From</h4>
              <input id="addin-from" type="datetime-local" />

      <br />

      <h4>To</h4>
      <input id="addin-to" type="datetime-local" />

      <hr />

      <p>
        <small>Last updated on September 9 2019</small>
      </p>

      <div id="addin-error"></div>

      <div id="addin-loading">
        <img src="https://www.geotab.com/mygeotab/addin/heatmap/images/loading.gif" alt="" />
      </div>

    </div>

  </div>

    <!-- <script type="text/javascript">
        geotab.addin.mapreplay = function(api, state) {
            var map;
            var vehicles;
            var initializeMap = function () {
                // Initialize the map container
								map = new L.Map("mapreplay-map").on("load", function () {
										setTimeout(function () {
												map.invalidateSize();
										}, 500);
									}).setView([44.94, -93.10], 13);
										// Add the map tiles layer
										document.getElementById("mapreplay-options").style.display = "block";
										L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
												subdomains: "abc",
												type: "osm",
												attribution: "&copy; <a href=\"https://osm.org/copyright\">OpenStreetMap</a> contributors",
												id: 'mapbox.streets',
												maxZoom: 18
										}).addTo(map);
								};
            var getVehicles = function (finishedCallback) {
                api.call("Get", {
                    typeName: "Device",
										'search': {
											'groups': [{'id': 'b278A'}]
										}
                }, function (results) {
                    vehicles = results.map(function (vehicle) {
                        return {
                            name: vehicle.name,
                            id: vehicle.id
                        };
                    });
                    finishedCallback();
                }, function (errorString) {
                    alert(errorString);
                });
            };
            var populateVehicleSelect = function () {
                var vehicleSelect = document.getElementById("mapreplay-options-vehicle");
                vehicleSelect.appendChild((function () {
                    var defaultOption = document.createElement("option");
                    defaultOption.default = true;
                    defaultOption.selected = true;
                    defaultOption.value = "";
                    defaultOption.textContent = "Select a vehicle...";
                    return defaultOption;
                })());
                if (vehicles) {
                    vehicles.forEach(function (vehicle) {
                        var opt = document.createElement("option");
                        opt.value = vehicle.id;
                        opt.textContent = vehicle.name;
                        vehicleSelect.appendChild(opt);
                    });
                }
            };
            return {
                /*
                 * Page lifecycle method: initialize is called once when the addin first starts
                 * Use this function to initialize the addin's state such as default values or
                 * make API requests (Geotab or external) to ensure interface is ready for the user.
                 */
                initialize: function(api, state, callback) {
                    // Initialize the map
                    initializeMap();
                    // Must be called to let the app know that we've initialized the addon
                    getVehicles(callback);
                },
                /*
                 * Page lifecycle method: focus is called when the page has finished initialize method
                 * and again when a user leaves and returns to your addin that has already been initialized.
                 * Use this function to refresh state such as vehicles, zones or exceptions which may have
                 * been modified since it was first initialized.
                 */
                focus: function() {
                    populateVehicleSelect();
                },
                /*
                 * Page lifecycle method: blur is called when the user is leaving your addin.
                 * Use this function to save state or commit changes to a datastore or release memory.
                 */
                blur: function() {
                }
            };
        };
    </script> -->
</body>
</html>
